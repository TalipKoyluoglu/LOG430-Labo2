@startuml
hide footbox
actor Employe
participant "main.py" as Main
participant "caisse.py" as Caisse
participant "Session SQLAlchemy" as Session
participant "Produit (ORM)" as Produit
participant "Vente (ORM)" as Vente
participant "LigneVente (ORM)" as LigneVente

Employe -> Main : Choisit "Enregistrer une vente"
Main -> Caisse : appeler enregistrer_vente(session)
loop Ajout de produits
    Caisse -> Employe : Demander ID et quantité
    Employe -> Caisse : Saisir ID/quantité
    Caisse -> Session : Récupère produit par ID
    Caisse -> Produit : Vérifie stock
    alt Stock insuffisant
        Caisse -> Employe : Affiche "[ERREUR]"
        break
    else
        Caisse -> Produit : Décrémente stock
        Caisse -> LigneVente : Crée ligne de vente
    end
end
Caisse -> Vente : Crée une nouvelle vente (date, total)
Caisse -> Session : session.add(vente) + lignes
Caisse -> Session : session.commit()
Caisse -> Employe : Confirmation de vente avec le total
@enduml
